<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¯¸ë””ì–´ ì—…ë¡œë“œ - ì‚´ë¦¬ëŠ” ë¹› ë¶€ì²œì¹¨ë¡€êµíšŒ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Google API -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', 'Inter', sans-serif;
        }
        .upload-card {
            transition: all 0.3s ease;
        }
        .upload-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .gallery-item {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .gallery-item:hover {
            transform: scale(1.02);
        }
        .gallery-item:hover .overlay {
            opacity: 1;
        }
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .loading {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100">
    <div class="min-h-screen py-8 px-4">
        <div class="max-w-7xl mx-auto">
            <!-- í—¤ë” -->
            <div class="bg-white rounded-2xl shadow-lg p-8 mb-8 border border-gray-100">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-4xl font-bold mb-2 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                            ë¯¸ë””ì–´ ê°¤ëŸ¬ë¦¬
                        </h1>
                        <p class="text-gray-600 text-lg">ì‚¬ì§„, ì˜ìƒ, PDF íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  ê´€ë¦¬í•˜ì„¸ìš”</p>
                    </div>
                    <a href="./index.html" class="px-4 py-2 text-gray-600 hover:text-gray-900 transition">
                        â† ëŒ€ì‹œë³´ë“œ
                    </a>
                </div>
            </div>

            <!-- ì—…ë¡œë“œ ì„¹ì…˜ -->
            <div class="bg-white rounded-2xl shadow-lg p-8 mb-8 border border-gray-100 upload-card">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">íŒŒì¼ ì—…ë¡œë“œ</h2>
                
                <!-- Google Drive ì—°ë™ -->
                <div class="mb-6">
                    <div class="bg-gradient-to-r from-green-50 to-blue-50 rounded-xl p-8 border-2 border-green-200">
                        <div class="text-center">
                            <div class="text-6xl mb-4">â˜ï¸</div>
                            <h3 class="text-2xl font-bold text-gray-800 mb-2">Google Driveì—ì„œ ì„ íƒ</h3>
                            <p class="text-sm text-gray-600 mb-4">Google Driveì— ì—…ë¡œë“œëœ íŒŒì¼ì„ ì„ íƒí•˜ì—¬ ê°¤ëŸ¬ë¦¬ì— ì¶”ê°€í•©ë‹ˆë‹¤</p>
                            <button onclick="openGoogleDrivePicker()" 
                                    class="bg-gradient-to-r from-green-600 to-blue-600 text-white px-8 py-3 rounded-xl font-semibold hover:from-green-700 hover:to-blue-700 transition shadow-lg hover:shadow-xl">
                                ğŸ“‚ Google Drive ì—´ê¸°
                            </button>
                            <div id="googleDriveStatus" class="mt-3">
                                <span class="text-xs text-gray-500">Google Driveì—ì„œ íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ì„ íƒëœ íŒŒì¼ ë¯¸ë¦¬ë³´ê¸° -->
                <div id="filePreview" class="hidden mb-6">
                    <h3 class="text-lg font-semibold mb-3 text-gray-700">ì„ íƒëœ íŒŒì¼</h3>
                    <div id="fileList" class="grid grid-cols-2 md:grid-cols-4 gap-3"></div>
                </div>

                <!-- ì¹´í…Œê³ ë¦¬ ì„ íƒ -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        ì¹´í…Œê³ ë¦¬
                    </label>
                    <select id="categorySelect" 
                            class="block w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-700">
                        <option value="worship">ì˜ˆë°°</option>
                        <option value="sermon">ì„¤êµ</option>
                        <option value="event">í–‰ì‚¬</option>
                        <option value="youth">ì²­ë…„ë¶€</option>
                        <option value="kids">ì£¼ì¼í•™êµ</option>
                        <option value="general">ê¸°íƒ€</option>
                    </select>
                </div>

                <!-- ì €ì¥ ë²„íŠ¼ -->
                <button onclick="uploadFiles()" 
                        id="uploadBtn"
                        class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-4 rounded-xl font-semibold hover:from-blue-700 hover:to-purple-700 transition-all shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed transform hover:scale-[1.02]">
                    <span id="uploadBtnText">ğŸ’¾ Google Drive ë§í¬ ì €ì¥í•˜ê¸°</span>
                </button>

                <!-- ì§„í–‰ ìƒíƒœ -->
                <div id="progressContainer" class="mt-4 hidden">
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div id="progressBar" class="bg-blue-600 h-2.5 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <p id="progressText" class="text-sm text-gray-600 mt-2 text-center"></p>
                </div>

                <!-- ë©”ì‹œì§€ -->
                <div id="message" class="mt-4 hidden"></div>
            </div>

            <!-- ì—…ë¡œë“œëœ íŒŒì¼ ëª©ë¡ -->
            <div class="bg-white rounded-2xl shadow-lg p-8 border border-gray-100">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">ì—…ë¡œë“œëœ ë¯¸ë””ì–´</h2>
                    <div class="flex gap-2">
                        <select id="filterCategory" onchange="loadMediaList()" 
                                class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
                            <option value="worship">ì˜ˆë°°</option>
                            <option value="sermon">ì„¤êµ</option>
                            <option value="event">í–‰ì‚¬</option>
                            <option value="youth">ì²­ë…„ë¶€</option>
                            <option value="kids">ì£¼ì¼í•™êµ</option>
                            <option value="general">ê¸°íƒ€</option>
                        </select>
                        <button onclick="loadMediaList()" 
                                class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition font-medium">
                            ğŸ”„ ìƒˆë¡œê³ ì¹¨
                        </button>
                    </div>
                </div>
                <div id="mediaList" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
                    <!-- ë¯¸ë””ì–´ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ================================================================
        // ì„¤ì • (Google Drive API ì„¤ì •)
        // ================================================================
        const GOOGLE_API_KEY = 'AIzaSyAR0pKih7x68qN5m0TKL8P34DAjh6VTN-o';
        const GOOGLE_CLIENT_ID = '1001319276716-8p4k4v3c00nt7qkb995u4avn23pg4s3n.apps.googleusercontent.com';
        
        // Google Drive í´ë” ID ë§¤í•‘
        const GOOGLE_DRIVE_FOLDERS = {
            'event': '1LjNa6LTwdZrGFcsDjereCDsP7QBZVryt',      // êµíšŒí–‰ì‚¬
            'kids': '1vhJxT8UCFbwOWQ4LOCwYgitndwFs3yvl',       // ìœ ì¹˜ë¶€
            'youth': '1JxUQ4AoFu1J3YGL_92kpKsyzjVXrQmXu'      // ì²­ë…„ë¶€
        };

        // Supabase ì´ˆê¸°í™”
        const SUPABASE_URL = 'https://fkqxalcwhqohrkdzwhvv.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZrcXhhbGN3aHFvaHJrZHp3aHZ2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ1MjE2MjAsImV4cCI6MjA1MDA5NzYyMH0.bKpBqLaWy6u1YvTG6gCtgaK8sgjYAP8CZR3Kf4p0C08';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Google Drive ê´€ë ¨ ë³€ìˆ˜
        let googleAuthToken = null;
        let selectedGoogleFiles = [];

        // ================================================================
        // Google Drive ì´ˆê¸°í™”
        // ================================================================
        async function initGoogleDrive() {
            if (GOOGLE_CLIENT_ID === 'YOUR_GOOGLE_CLIENT_ID') {
                document.getElementById('googleDriveStatus').innerHTML = 
                    '<span class="text-xs text-yellow-500">âš ï¸ OAuth í´ë¼ì´ì–¸íŠ¸ ID ì„¤ì • í•„ìš”</span>';
                return;
            }

            try {
                // Google API ë¡œë“œ
                await new Promise((resolve, reject) => {
                    if (typeof gapi === 'undefined') {
                        reject(new Error('Google APIë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'));
                        return;
                    }
                    gapi.load('picker', { callback: resolve, onerror: reject });
                });

                document.getElementById('googleDriveStatus').innerHTML = 
                    '<span class="text-xs text-green-500">âœ“ ì—°ê²° ì¤€ë¹„ë¨</span>';
            } catch (error) {
                console.error('Google Drive ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                document.getElementById('googleDriveStatus').innerHTML = 
                    '<span class="text-xs text-red-500">ì—°ê²° ì‹¤íŒ¨</span>';
            }
        }

        // ================================================================
        // Google Drive Picker ì—´ê¸°
        // ================================================================
        async function openGoogleDrivePicker() {
            if (GOOGLE_CLIENT_ID === 'YOUR_GOOGLE_CLIENT_ID') {
                showMessage('âš ï¸ Google OAuth í´ë¼ì´ì–¸íŠ¸ IDë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”. GOOGLE-DRIVE-SETUP.md íŒŒì¼ì„ ì°¸ê³ í•˜ì„¸ìš”.', 'warning');
                return;
            }

            try {
                // OAuth í† í° ê°€ì ¸ì˜¤ê¸°
                const tokenClient = google.accounts.oauth2.initTokenClient({
                    client_id: GOOGLE_CLIENT_ID,
                    scope: 'https://www.googleapis.com/auth/drive.readonly',
                    callback: async (tokenResponse) => {
                        if (tokenResponse.error) {
                            showMessage('Google ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + tokenResponse.error, 'error');
                            return;
                        }

                        // í† í° ì €ì¥
                        googleAuthToken = tokenResponse.access_token;

                        // ì¹´í…Œê³ ë¦¬ì— ë§ëŠ” í´ë” ID ê°€ì ¸ì˜¤ê¸°
                        const category = document.getElementById('categorySelect').value;
                        const folderId = GOOGLE_DRIVE_FOLDERS[category];

                        // Picker ìƒì„±
                        const view = new google.picker.DocsView(google.picker.ViewId.DOCS_IMAGES_AND_VIDEOS)
                            .setIncludeFolders(false)
                            .setSelectFolderEnabled(false);
                        
                        // íŠ¹ì • í´ë”ê°€ ìˆìœ¼ë©´ í•´ë‹¹ í´ë”ë¡œ ì œí•œ
                        if (folderId) {
                            view.setParent(folderId);
                        }

                        const picker = new google.picker.PickerBuilder()
                            .enableFeature(google.picker.Feature.MULTISELECT_ENABLED)
                            .setOAuthToken(tokenResponse.access_token)
                            .setCallback(pickerCallback)
                            .addView(view)
                            .setTitle(folderId ? `Google Drive - ${category === 'event' ? 'êµíšŒí–‰ì‚¬' : category === 'kids' ? 'ìœ ì¹˜ë¶€' : 'ì²­ë…„ë¶€'} í´ë”` : 'Google Driveì—ì„œ íŒŒì¼ ì„ íƒ')
                            .build();

                        picker.setVisible(true);
                    }
                });

                tokenClient.requestAccessToken();
            } catch (error) {
                console.error('Google Picker ì˜¤ë¥˜:', error);
                showMessage('Google Drive ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
            }
        }

        // ================================================================
        // Google Picker ì½œë°±
        // ================================================================
        async function pickerCallback(data) {
            if (data[google.picker.Response.ACTION] === google.picker.Action.PICKED) {
                const docs = data[google.picker.Response.DOCUMENTS];
                selectedGoogleFiles = [];

                showMessage(`ğŸ“¥ ${docs.length}ê°œ íŒŒì¼ì„ ì„ íƒí–ˆìŠµë‹ˆë‹¤.`, 'success');

                // Google Drive íŒŒì¼ ì •ë³´ë¥¼ ê·¸ëŒ€ë¡œ ì €ì¥ (ë‹¤ìš´ë¡œë“œí•˜ì§€ ì•ŠìŒ)
                selectedGoogleFiles = docs.map(doc => ({
                    id: doc.id,
                    name: doc.name,
                    mimeType: doc.mimeType,
                    url: doc.url,
                    embedUrl: `https://drive.google.com/file/d/${doc.id}/preview`,
                    thumbnailUrl: `https://drive.google.com/thumbnail?id=${doc.id}&sz=w400`,
                    originalUrl: `https://drive.google.com/uc?id=${doc.id}`
                }));

                // íŒŒì¼ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
                displayFilePreview(selectedGoogleFiles);
                showMessage(`âœ… ${selectedGoogleFiles.length}ê°œ íŒŒì¼ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
            }
        }

        // ================================================================
        // íŒŒì¼ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ (Google Drive íŒŒì¼)
        // ================================================================
        function displayFilePreview(files) {
            const previewDiv = document.getElementById('filePreview');
            const fileListDiv = document.getElementById('fileList');

            if (!files || files.length === 0) {
                previewDiv.classList.add('hidden');
                return;
            }

            previewDiv.classList.remove('hidden');
            fileListDiv.innerHTML = '';

            files.forEach((file, index) => {
                const isImage = file.mimeType && file.mimeType.startsWith('image/');
                const fileCard = document.createElement('div');
                fileCard.className = 'border rounded-lg p-2 bg-gray-50';
                
                if (isImage) {
                    fileCard.innerHTML = `
                        <img src="${file.thumbnailUrl}" alt="${file.name}" 
                             class="w-full h-24 object-cover rounded mb-1">
                        <p class="text-xs text-gray-600 truncate" title="${file.name}">${file.name}</p>
                        <p class="text-xs text-blue-500">â˜ï¸ Google Drive</p>
                    `;
                } else {
                    fileCard.innerHTML = `
                        <div class="w-full h-24 bg-gray-200 rounded mb-1 flex items-center justify-center">
                            <span class="text-3xl">ğŸ“„</span>
                        </div>
                        <p class="text-xs text-gray-600 truncate" title="${file.name}">${file.name}</p>
                        <p class="text-xs text-blue-500">â˜ï¸ Google Drive</p>
                    `;
                }
                
                fileListDiv.appendChild(fileCard);
            });
        }

        // ================================================================
        // Google Drive íŒŒì¼ ë§í¬ ì €ì¥ (ì—…ë¡œë“œ ì—†ì´)
        // ================================================================
        async function uploadFiles() {
            const category = document.getElementById('categorySelect').value;
            const uploadBtn = document.getElementById('uploadBtn');
            const uploadBtnText = document.getElementById('uploadBtnText');
            const progressContainer = document.getElementById('progressContainer');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const messageDiv = document.getElementById('message');

            if (selectedGoogleFiles.length === 0) {
                showMessage('Google Driveì—ì„œ íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            // UI ì—…ë°ì´íŠ¸
            uploadBtn.disabled = true;
            uploadBtnText.innerHTML = '<span class="loading">â³ ì €ì¥ ì¤‘...</span>';
            progressContainer.classList.remove('hidden');
            messageDiv.classList.add('hidden');

            let successCount = 0;
            let errorCount = 0;

            for (let i = 0; i < selectedGoogleFiles.length; i++) {
                const file = selectedGoogleFiles[i];
                const progress = ((i + 1) / selectedGoogleFiles.length * 100).toFixed(0);
                progressBar.style.width = progress + '%';
                progressText.textContent = `ì €ì¥ ì¤‘... (${i + 1}/${selectedGoogleFiles.length}): ${file.name}`;

                try {
                    // Google Drive ë§í¬ë§Œ ì €ì¥ (íŒŒì¼ì€ ì—…ë¡œë“œí•˜ì§€ ì•ŠìŒ)
                    const { error: dbError } = await supabase
                        .from('media_library')
                        .insert({
                            file_name: `gdrive_${file.id}`, // Google Drive IDë¡œ êµ¬ë¶„
                            original_name: file.name,
                            file_url: file.embedUrl || file.originalUrl, // Google Drive embed ë§í¬
                            file_type: file.mimeType || 'application/octet-stream',
                            file_size: 0, // Google Drive íŒŒì¼ì´ë¯€ë¡œ í¬ê¸° ì •ë³´ ì—†ìŒ
                            folder: category
                        });

                    if (dbError) throw dbError;

                    successCount++;
                    console.log('âœ… Google Drive ë§í¬ ì €ì¥ ì„±ê³µ:', file.name);

                } catch (error) {
                    errorCount++;
                    console.error('âŒ ì €ì¥ ì‹¤íŒ¨:', file.name, error);
                }
            }

            // ì™„ë£Œ ë©”ì‹œì§€
            uploadBtn.disabled = false;
            uploadBtnText.textContent = 'ğŸ’¾ Google Drive ë§í¬ ì €ì¥í•˜ê¸°';
            progressText.textContent = 'ì €ì¥ ì™„ë£Œ!';
            
            if (errorCount === 0) {
                showMessage(`âœ… ${successCount}ê°œ íŒŒì¼ì˜ Google Drive ë§í¬ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
            } else {
                showMessage(`âš ï¸ ${successCount}ê°œ ì„±ê³µ, ${errorCount}ê°œ ì‹¤íŒ¨`, 'warning');
            }

            selectedGoogleFiles = [];
            document.getElementById('filePreview').classList.add('hidden');

            // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            setTimeout(() => {
                loadMediaList();
            }, 1000);
        }

        // ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.classList.remove('hidden');
            
            const bgColor = type === 'success' ? 'bg-green-100 text-green-800' :
                           type === 'error' ? 'bg-red-100 text-red-800' :
                           'bg-yellow-100 text-yellow-800';
            
            messageDiv.className = `mt-4 p-4 rounded-lg ${bgColor}`;
            messageDiv.textContent = text;
        }

        // ================================================================
        // ë¯¸ë””ì–´ ëª©ë¡ ë¡œë“œ
        // ================================================================
        async function loadMediaList() {
            const mediaList = document.getElementById('mediaList');
            const filterCategory = document.getElementById('filterCategory').value;
            mediaList.innerHTML = '<div class="col-span-full text-center py-12"><div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div><p class="mt-4 text-gray-500">ë¡œë”© ì¤‘...</p></div>';

            try {
                let query = supabase
                    .from('media_library')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(100);

                if (filterCategory) {
                    query = query.eq('folder', filterCategory);
                }

                const { data, error } = await query;

                if (error) throw error;

                if (data.length === 0) {
                    mediaList.innerHTML = '<div class="col-span-full text-center py-12"><p class="text-gray-500 text-lg">ì—…ë¡œë“œëœ ë¯¸ë””ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</p></div>';
                    return;
                }

                mediaList.innerHTML = data.map(item => {
                    const isImage = item.file_type?.startsWith('image/');
                    const isVideo = item.file_type?.startsWith('video/');
                    const sizeInMB = (item.file_size / 1024 / 1024).toFixed(2);
                    const categoryLabels = {
                        worship: 'ì˜ˆë°°',
                        sermon: 'ì„¤êµ',
                        event: 'í–‰ì‚¬',
                        youth: 'ì²­ë…„ë¶€',
                        kids: 'ì£¼ì¼í•™êµ',
                        general: 'ê¸°íƒ€'
                    };

                    return `
                        <div class="gallery-item border border-gray-200 rounded-xl overflow-hidden bg-white shadow-sm">
                            ${isImage ? `
                                <div class="relative aspect-square">
                                    <img src="${item.file_url}" alt="${item.original_name}" 
                                         class="w-full h-full object-cover">
                                    <div class="overlay">
                                        <button onclick="copyUrl('${item.file_url}')" 
                                                class="px-3 py-2 bg-white text-gray-800 rounded-lg hover:bg-gray-100 text-sm font-medium">
                                            ğŸ“‹ URL ë³µì‚¬
                                        </button>
                                        <button onclick="deleteMedia('${item.id}', '${item.file_name}')" 
                                                class="px-3 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 text-sm font-medium">
                                            ğŸ—‘ï¸ ì‚­ì œ
                                        </button>
                                    </div>
                                </div>
                            ` : isVideo ? `
                                <div class="relative aspect-square">
                                    <video src="${item.file_url}" 
                                           class="w-full h-full object-cover"
                                           controls></video>
                                    <div class="overlay">
                                        <button onclick="copyUrl('${item.file_url}')" 
                                                class="px-3 py-2 bg-white text-gray-800 rounded-lg hover:bg-gray-100 text-sm font-medium">
                                            ğŸ“‹ URL ë³µì‚¬
                                        </button>
                                        <button onclick="deleteMedia('${item.id}', '${item.file_name}')" 
                                                class="px-3 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 text-sm font-medium">
                                            ğŸ—‘ï¸ ì‚­ì œ
                                        </button>
                                    </div>
                                </div>
                            ` : `
                                <div class="relative aspect-square bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center">
                                    <span class="text-6xl">ğŸ“„</span>
                                    <div class="overlay">
                                        <button onclick="copyUrl('${item.file_url}')" 
                                                class="px-3 py-2 bg-white text-gray-800 rounded-lg hover:bg-gray-100 text-sm font-medium">
                                            ğŸ“‹ URL ë³µì‚¬
                                        </button>
                                        <button onclick="deleteMedia('${item.id}', '${item.file_name}')" 
                                                class="px-3 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 text-sm font-medium">
                                            ğŸ—‘ï¸ ì‚­ì œ
                                        </button>
                                    </div>
                                </div>
                            `}
                            <div class="p-3">
                                <p class="font-semibold text-sm text-gray-800 truncate mb-1" title="${item.original_name}">${item.original_name}</p>
                                <div class="flex items-center justify-between text-xs text-gray-500">
                                    <span class="px-2 py-1 bg-blue-50 text-blue-700 rounded-full">${categoryLabels[item.folder] || item.folder}</span>
                                    <span>${sizeInMB} MB</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                console.log('âœ… ë¯¸ë””ì–´ ëª©ë¡ ë¡œë“œ ì™„ë£Œ:', data.length);

            } catch (error) {
                console.error('âŒ ë¯¸ë””ì–´ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                mediaList.innerHTML = '<div class="col-span-full text-center py-12"><p class="text-red-500 text-lg">ë¡œë“œ ì‹¤íŒ¨: ' + error.message + '</p></div>';
            }
        }

        // ================================================================
        // URL ë³µì‚¬
        // ================================================================
        async function copyUrl(url) {
            try {
                await navigator.clipboard.writeText(url);
                showMessage('âœ… URLì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            } catch (error) {
                // ëŒ€ì²´ ë°©ë²•
                const textArea = document.createElement('textarea');
                textArea.value = url;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showMessage('âœ… URLì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            }
        }

        // ë¯¸ë””ì–´ ì‚­ì œ
        async function deleteMedia(id, fileName) {
            if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            try {
                // Storageì—ì„œ íŒŒì¼ ì‚­ì œ
                const { error: storageError } = await supabase.storage
                    .from('media')
                    .remove([fileName]);

                if (storageError) throw storageError;

                // DBì—ì„œ ë©”íƒ€ë°ì´í„° ì‚­ì œ
                const { error: dbError } = await supabase
                    .from('media_library')
                    .delete()
                    .eq('id', id);

                if (dbError) throw dbError;

                showMessage('âœ… ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                loadMediaList();

            } catch (error) {
                console.error('âŒ ì‚­ì œ ì‹¤íŒ¨:', error);
                showMessage('âŒ ì‚­ì œ ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }

        // ================================================================
        // ì´ˆê¸°í™”
        // ================================================================
        window.addEventListener('DOMContentLoaded', async () => {
            loadMediaList();
            // Google Drive ì´ˆê¸°í™” (OAuth í´ë¼ì´ì–¸íŠ¸ IDê°€ ì„¤ì •ëœ ê²½ìš°ì—ë§Œ)
            if (GOOGLE_CLIENT_ID !== 'YOUR_GOOGLE_CLIENT_ID') {
                await initGoogleDrive();
            }
        });
    </script>
</body>
</html>







